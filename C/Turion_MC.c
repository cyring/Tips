/*
# lspci -xxxx -s 0:18.1
00:18.1 Host bridge: Advanced Micro Devices, Inc.\
 [AMD] K8 [Athlon64/Opteron] Address Map
00: 22 10 01 11 00 00 00 00 00 00 00 06 00 00 80 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
40: 03 00 00 00 00 00 7f 00 00 00 00 00 01 00 00 00
50: 00 00 00 00 02 00 00 00 00 00 00 00 03 00 00 00
60: 00 00 00 00 04 00 00 00 00 00 00 00 05 00 00 00
70: 00 00 00 00 06 00 00 00 00 00 00 00 07 00 00 00
80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
90: 03 00 d0 00 00 ff df 00 03 00 c8 00 80 ff cf 00
a0: 03 0a 00 00 00 0b 00 00 03 00 f0 00 00 ff ff 00
b0: 03 00 e0 00 80 ff ef 00 03 00 80 00 00 ff c7 00
c0: 00 00 00 00 00 00 00 00 13 10 00 00 00 f0 0f 00
d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
e0: 03 00 00 ff 00 00 00 00 00 00 00 00 00 00 00 00
f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

# lspci -xxxx -s 0:18.2
00:18.2 Host bridge: Advanced Micro Devices, Inc.\
 [AMD] K8 [Athlon64/Opteron] DRAM Controller
00: 22 10 02 11 00 00 00 00 00 00 00 06 00 00 80 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
40: 01 00 00 00 01 01 00 00 00 00 00 00 00 00 00 00
50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
60: e0 3e 78 00 00 00 00 00 00 00 00 00 00 00 00 00
70: 00 00 00 00 00 00 00 00 46 00 00 00 00 00 00 00
80: 02 00 00 00 00 00 00 00 13 91 16 5d 20 12 12 00
90: 20 0c 01 00 79 80 00 77 39 00 00 80 00 00 00 00
a0: ef 06 00 5d 00 00 00 00 00 00 00 00 00 00 00 00
b0: 96 e6 63 1f e9 00 00 00 f1 7f c1 fb 4b e8 c4 01
c0: 00 00 02 00 00 00 00 00 00 00 00 00 00 00 00 00
d0: fc 0c e0 1f f2 7c ee 49 df b9 84 07 78 bc ad ef
e0: 7c 04 f4 0f 70 7e a7 00 e7 d6 80 07 74 fc 14 c7
f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

# lspci -xxxx -s 0:18.3
00:18.3 Host bridge: Advanced Micro Devices, Inc.\
 [AMD] K8 [Athlon64/Opteron] Miscellaneous Control
00: 22 10 03 11 00 00 10 00 00 00 00 06 00 00 80 00
10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
30: 00 00 00 00 f0 00 00 00 00 00 00 00 00 00 00 00
40: ff 3b 04 00 40 00 10 0a 00 00 00 00 00 00 00 00
50: 00 00 00 00 40 00 00 00 00 00 00 00 00 fc 02 40
60: fe 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00
70: 11 01 32 51 21 40 70 50 00 2a 00 08 17 21 00 00
80: 31 37 07 33 13 31 13 31 00 00 00 00 00 00 00 00
90: 00 00 00 00 18 11 00 00 f0 15 ae a2 00 00 00 00
a0: 9e 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
d0: 00 00 00 00 01 a7 0d 00 00 00 10 0d 25 26 26 00
e0: 00 00 00 00 3a ce 64 00 01 17 00 00 00 00 00 00
f0: 0f 00 10 00 00 00 00 00 00 00 00 00 81 0f 06 00
*/
#include <stdio.h>
int main(int argc, char *argv[])
{
	union {
		unsigned int		v32;
		unsigned char		v08[4];
		struct {
			unsigned int	CSEn	:  1-0,
					Spare	:  2-1,
					MemFail	:  3-2,
					Rsvd1	:  5-3,
					AddrLo	: 14-5,
					Rsvd2	: 19-14,
					AddrHi	: 29-19,
					Rsvd3	: 32-29;
		};
	} F2Off40[8] = {
		{.v08[0]=0x01, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x01, .v08[1]=0x01, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x00, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x00, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x00, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x00, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x00, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
		{.v08[0]=0x00, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00},
	};
	unsigned char F2Off60[4] = {
		0xe0, 0x3e, 0x78, 0x00
	};
	union {
		unsigned int		v32;
		unsigned char		v08[4];
		struct {
			unsigned int	CS10	:  4-0,
					CS32	:  8-4,
					CS54	: 12-8,
					CS76	: 16-12,
					Rsvd	: 32-16;
		};
	} F2Off80 = {.v08[0]=0x02, .v08[1]=0x00, .v08[2]=0x00, .v08[3]=0x00};

	signed int CS, F2MaskOffset;
	unsigned long CSBase, CSMask;

	printf("Bank: CS10(%x) CS32(%x) CS54(%x) CS76(%x)\n",
		F2Off80.CS10, F2Off80.CS32, F2Off80.CS54, F2Off80.CS76);

	for (CS = 0; CS < 8; CS++){

//		F2MaskOffset = F2Off60[(CS % 2) ? ((CS - 1) >> 1):(CS >> 1)];

		CSBase = (F2Off40[CS].AddrHi << 16) | F2Off40[CS].AddrLo;

		CSMask = (F2MaskOffset | 0x0007c01f) & 0x1fffffff;

		printf("CS(%d:%x): Enable(%u) Base(%x) Mask(%x)\n",
			CS, F2Off40[CS].v32, F2Off40[CS].CSEn, CSBase, CSMask);
	}
	return(0);
}
